/*! Copyright Weeblr llc 2017 - Licence: http://www.gnu.org/copyleft/gpl.html GNU/GPL */
!function(e,t,a,s){"use strict";function r(){o(s(this))}function n(){var e=s(this).data("scope");f[e].msgArea.removeClass("wb-success wb-error").addClass("wb-warning").html("Cancelling import process."),m(e)}function o(e){var t=e.data("scope");t&&!f[t]&&(w(t,!0),e.attr("disabled","disabled"),f[t]={status:"running",startButton:e,cancelButton:s(".wb-js-button-cancel-"+t),msgArea:s(".wb-js-message-area-"+t),request:null,id:null},f[t].msgArea.removeClass("wb-error wb-warning").addClass("wb-success").html("Starting to import data, please wait..."),e.hide(),f[t].cancelButton.show(),c(t))}function c(t){if(!f[t])return console.error("Import error: unknown scope"),void p(t);var a=e.baseUrl+"/index.php?option=com_ajax&group=sh404sefcore&plugin=importer&format=json&scope="+t;a+=f[t].id?"&next_step=continue_import&id="+f[t].id:"&next_step=start_import";var r=s("#style-form").serialize();f[t].request=s.post({url:a,data:r}).done(function(e){i(t,e)}).fail(function(e){l(t,e)})}function i(e,t){if(!f[e]){var a="Not expecting this response, import may have been cancelled.";return console.error(a),void p(e)}if(f[e].request=null,!t||!t.success){var a=t&&t.message?t.message:"Error communicating with server, aborting.";return console.error(a),u(e,a),void p(e)}d(e,t)}function l(e,t){console.log("Ajax request failure"),console.error(t.statusText),f[e].request=null,u(e,"Error communicating with server: "+t.statusText),p(e)}function d(e,t){switch(t.data[0].next_step){case"continue":if(f[e].status="running",f[e].id=f[e].id?f[e].id:t.data[0].id,t.data[0].data_type){var a=t.data[0].data_type;f[e].msgArea.removeClass("wb-error wb-warning").addClass("wb-success").html("Import of "+t.data[0].data_type+" in progress: "+t.data[0].done[a]+" / "+t.data[0].processed[a]+" / "+t.data[0].total[a])}c(e);break;case"cancelled":break;case"completed":var r="";s.each(t.data[0].done,function(e,a){r+=r?" - ":"",r+=e+": "+a+" / "+t.data[0].processed[e]}),r="<p>Completed (imported/processed): "+r+"</p>",r+="<p>Site is offline, and sh404SEF has been disabled. Please verify imported data, enable back sh404SEF and set back site online when ready.</p>",f[e].msgArea.removeClass("wb-error wb-warning").addClass("wb-success").html(r),p(e)}}function u(e,t){console.log("Error message: "+t),f[e].msgArea.removeClass("wb-success wb-warning").addClass("wb-error").html(t)}function m(e){e&&f[e]&&"running"==f[e].status&&(f[e].msgArea.removeClass("wb-success wb-error").addClass("wb-warning").html("Import cancelled!"),p(e))}function p(e){f[e]&&(f[e].cancelButton.hide(),f[e].startButton.show(),f[e].startButton.attr("disabled",null),f[e]=null),w(e,!1)}function w(e,t){var a=s("#jform_params_"+e+"_settings_toggle");b(a,!t)}function b(e,t){t?(e.attr("checked","checked"),e.val(1)):(e.attr("checked",""),e.val(0)),e.change()}function g(){try{s(".wb-js-button-start").on("click",r),s(".wb-js-button-cancel").on("click",n),s(".wb-js-button-cancel").hide()}catch(e){console.log("Error setting up sh404sef importer javascript: "+e.message)}}var f={};return s(a).ready(g),e}(window.weeblrApp=window.weeblrApp||{},window,document,jQuery);
